<component name="UdpReceiver" kind="passive" namespace="CubeRover">

    <import_port_type>Svc/Sched/SchedPortAi.xml</import_port_type>
    <import_port_type>Fw/Buffer/BufferSendPortAi.xml</import_port_type>
    <import_port_type>Fw/Buffer/BufferGetPortAi.xml</import_port_type>

        <comment>Receives packets via a UDP connection</comment>
        <ports>
            <port name="uplinkData" data_type="Fw::BufferSend" kind="sync_input" max_number="2">
                <comment>
                    A comm source sends a buffer object pointing to the datagram and the size of
                    datagram that was received. UDP Receier will validate the
                    datagram and get a buffer from the ground interface via
                    forwardDatagramPayload and hand off the **payload** to the
                    ground interface.
                    0: WatchDog Serial  1: WF121
                </comment>
            </port>
            <port name="forwardDatagramPayload" data_type="Fw::BufferSend" kind="output" max_number="1">
                <comment>
                    Get a buffer managed by the ground interface to store the **payload** of the
                    received datagram.
                </comment>
            </port>
        </ports>

    <events>
        <event id="0" name="UR_PortOpened" severity="ACTIVITY_HI" format_string = "UdpReceiver port %d opened">
            <comment>
            Connection opened
            </comment>
            <args>
                <arg name = "port" type = "U32"/>
            </args>
        </event>
        <event id="1" name="UR_RecvError" severity="WARNING_HI" format_string = "UDPReceiver receive error: %d">
            <comment>
            UDP receive error
            </comment>
            <args>
                <arg name = "error" type = "I32"/>
            </args>
        </event>
        <event id="2" name="UR_DecodeError" severity="WARNING_HI" format_string = "Port decode error in stage %d: %d" throttle="5">
            <comment>
            Port decode error
            </comment>
            <args>
                <arg name="stage" type="ENUM">
                    <enum name="DecodeStage">
                        <item name="DECODE_HEADER"/>
                        <item name="DECODE_PAYLOAD"/>           
                    </enum>
                </arg>
                <arg name = "error" type = "I32"/>
            </args>
        </event>
        <event id="5" name="UR_DroppedPacket" severity="WARNING_HI" format_string = "UDP packet(s) dropped (checksum %d)" throttle="5">
            <comment>
            Dropped packet was detected
            </comment>
            <args>
                <arg name = "checksum" type = "U32"/>
            </args>
        </event>
    </events>
    
    <telemetry>
        <channel id="0" name="UR_PacketsReceived" data_type="U32" update = "on_change">
            <comment>
            Number of packets received
            </comment>
        </channel>
        <channel id="1" name="UR_BytesReceived" data_type="U32" update = "on_change">
            <comment>
            Number of bytes received
            </comment>
        </channel>
        <channel id="2" name="UR_PacketsDropped" data_type="U32" update = "on_change">
            <comment>
            Number of packets dropped
            </comment>
        </channel>
        <channel id="3" name="UR_DecodeErrors" data_type="U32" update = "on_change">
            <comment>
            Number of packet decode errors
            </comment>
        </channel>
    </telemetry>
</component>

